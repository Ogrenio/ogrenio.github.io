(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{6147:function(e,a,t){Promise.resolve().then(t.bind(t,8999))},9376:function(e,a,t){"use strict";var r=t(5475);t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}})},8999:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return h}});var r=t(7437),l=t(2265),i=t(7996),s=t(4230),n=t(5978);let d=async(e,a)=>{try{if(null!==a){let t=await u(e.kurumId);if(t.length>=a)throw Error("Kurum kontenjanı dolu (".concat(t.length,"/").concat(a,")"))}let t=(0,n.hJ)(s.db,"users"),r=(0,n.IO)(t,(0,n.ar)("email","==",e.email.toLowerCase())),l=await (0,n.PL)(r);if(l.empty)throw Error('"'.concat(e.email,'" email adresine sahip kullanıcı bulunamadı'));let i=l.docs[0],d=i.id,c=i.data();if((await u(e.kurumId)).some(e=>e.id===d))throw Error("".concat(c.email," zaten bu kuruma kayıtlı"));let m=new Date,o=new Date(m);return o.setDate(m.getDate()+30),await (0,n.ET)((0,n.hJ)(s.db,"purchases"),{userId:d,userEmail:c.email,productId:"paket_30_monthly",productName:"Kurum Aylık Paketi",purchaseDate:m,expirationDate:o,status:"completed",kurumId:e.kurumId}),await (0,n.ET)((0,n.hJ)(s.db,"kurumUsers"),{userId:d,kurumId:e.kurumId,email:c.email,joinDate:new Date().toISOString()}),await (0,n.pl)((0,n.JU)(s.db,"users",d),{kurumId:e.kurumId},{merge:!0}),{userId:d,email:c.email}}catch(a){throw console.error("Kuruma kullanıcı ekleme hatası:",{error:a,inputEmail:e.email,kurumId:e.kurumId}),a}},u=async e=>{try{let a=(0,n.hJ)(s.db,"kurumUsers"),t=(0,n.IO)(a,(0,n.ar)("kurumId","==",e)),r=(await (0,n.PL)(t)).docs.map(e=>e.data().userId);if(0===r.length)return[];let l=r.map(async e=>{let a=await (0,n.QT)((0,n.JU)(s.db,"users",e));return{id:e,...a.data()}});return await Promise.all(l)}catch(e){throw console.error("Error fetching kurum users: ",e),e}},c=async(e,a)=>{try{let t=(0,n.hJ)(s.db,"kurumUsers"),r=(0,n.IO)(t,(0,n.ar)("userId","==",e),(0,n.ar)("kurumId","==",a)),l=await (0,n.PL)(r);if(l.empty)throw Error("Kurum-kullanıcı ilişkisi bulunamadı");let i=l.docs.map(e=>(0,n.oe)(e.ref));return await Promise.all(i),await (0,n.pl)((0,n.JU)(s.db,"users",e),{kurumId:null},{merge:!0}),!0}catch(e){throw console.error("Error removing user from kurum: ",e),e}};var m=t(974),o=t(9064),x=t(9376),h=()=>{let e=(0,x.useRouter)(),[a,t]=(0,l.useState)(!1),[s,n]=(0,l.useState)([]),{user:h,kurumKontejan:g,isStudent:f,kurum:p,kurumId:y,isSuperAdmin:b}=(0,m.Z)(),[w,v]=(0,l.useState)(!0),[j,k]=(0,l.useState)({email:"",ogrenciMi:!0,studentCode:"",teacherCode:""}),[N,I]=(0,l.useState)(""),[S,z]=(0,l.useState)(1),K=async e=>{if(!y){o.Am.error("Kurum bilgisi bulunamadı");return}if(window.confirm("Bu kullanıcıyı kurumdan \xe7ıkarmak istediğinize emin misiniz?"))try{await c(e,y);let a=await u(y);n(a),o.Am.success("Kullanıcı kurumdan başarıyla \xe7ıkarıldı")}catch(e){console.error("Error removing user: ",e),o.Am.error("Kullanıcı \xe7ıkarılırken hata oluştu: "+e.message)}};(0,l.useEffect)(()=>{t(!0),(async()=>{try{if(y){let e=await u(y);n(e)}else o.Am.error("Kurum bilgisi bulunamadı")}catch(e){console.error("Error fetching users: ",e),o.Am.error("Kullanıcılar y\xfcklenirken hata oluştu")}finally{v(!1)}})()},[y]);let C=async()=>{if(!j.email||!y){o.Am.error("Email alanı boş bırakılamaz");return}try{if(null!==g&&s.length>=g){o.Am.error("Kurum kontenjanı dolu (".concat(s.length,"/").concat(g,"). Daha fazla kullanıcı ekleyemezsiniz."));return}await d({email:j.email,kurumId:y},g);let e=await u(y);n(e),k({email:"",ogrenciMi:!0,studentCode:"",teacherCode:""}),o.Am.success("Kullanıcı başarıyla eklendi")}catch(e){console.error("Error adding user: ",e),o.Am.error("Kullanıcı eklenirken hata oluştu: "+e.message)}},E=s.filter(e=>{let a=N.toLowerCase();return e.isim&&e.isim.toLowerCase().includes(a)||e.email&&e.email.toLowerCase().includes(a)||e.ogrenciMi&&e.studentCode&&e.studentCode.toLowerCase().includes(a)||!e.ogrenciMi&&e.teacherCode&&e.teacherCode.toLowerCase().includes(a)}),A=5*S,D=A-5,L=E.slice(D,A),M=Math.ceil(E.length/5);return!a||w?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-amber-600 text-lg",children:"Y\xfckleniyor..."})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[b&&(0,r.jsx)("div",{className:"mb-4 flex justify-end",children:(0,r.jsxs)("button",{onClick:()=>{e.push("/superadmin")},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",children:[(0,r.jsx)(i.bfl,{className:"mr-2 h-4 w-4"}),"S\xfcperadmin Paneli"]})}),h&&(0,r.jsx)("div",{className:"bg-white shadow rounded-lg p-6 mb-8",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4 mb-4 md:mb-0",children:[(0,r.jsx)("div",{className:"flex-shrink-0 h-12 w-12 rounded-full bg-amber-100 flex items-center justify-center",children:(0,r.jsx)(i.fzv,{className:"h-6 w-6 text-amber-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:h.email}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:f?"\xd6ğrenci":"\xd6ğretmen"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(i.m6D,{className:"h-5 w-5 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Kurum"}),(0,r.jsx)("p",{className:"text-sm text-gray-900",children:p||"Bilinmiyor"})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(i.WY8,{className:"h-5 w-5 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Kurum \xdcye Kontenjanı"}),(0,r.jsx)("p",{className:"text-sm text-gray-900",children:null!==g?(0,r.jsxs)("span",{children:[s.length,"/",g," (Kalan: ",g-s.length,")"]}):"Sınırsız"}),null!==g&&(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mt-1",children:(0,r.jsx)("div",{className:"bg-amber-600 h-1.5 rounded-full",style:{width:"".concat(Math.min(100,s.length/g*100),"%")}})})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(i.yK7,{className:"h-5 w-5 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Durum"}),(0,r.jsx)("p",{className:"text-sm text-gray-900",children:f?"\xd6ğrenci":"\xd6ğretmen"})]})]})]})]})}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Kurum Y\xf6netimi"}),(0,r.jsxs)("div",{className:"relative mt-4 md:mt-0 w-full md:w-auto",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)(i.jRj,{className:"h-5 w-5 text-gray-400"})}),(0,r.jsx)("input",{type:"text",placeholder:"Kullanıcı ara...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 sm:text-sm",value:N,onChange:e=>I(e.target.value)})]})]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden mb-8",children:[(0,r.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Yeni Kullanıcı Ekle"}),(0,r.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Adresi"}),(0,r.jsx)("input",{type:"email",id:"email",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm",placeholder:"email@example.com",value:j.email,onChange:e=>k({...j,email:e.target.value})})]}),(0,r.jsx)("div",{className:"flex items-end space-x-4",children:(0,r.jsxs)("button",{type:"button",onClick:C,disabled:!j.email,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,r.jsx)(i.OvN,{className:"mr-2 h-4 w-4"}),"Kullanıcı Ekle"]})})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kullanıcı"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"T\xfcr"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kod"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Katılım Tarihi"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"İşlemler"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:L.length>0?L.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-amber-100 flex items-center justify-center",children:(0,r.jsx)(i.fzv,{className:"h-5 w-5 text-amber-600"})}),(0,r.jsx)("div",{className:"ml-4",children:(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.isim||"İsim belirtilmemiş"})})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(i.Imn,{className:"flex-shrink-0 mr-2 h-4 w-4 text-gray-400"}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.ogrenciMi?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:e.ogrenciMi?"\xd6ğrenci":"\xd6ğretmen"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.ogrenciMi?e.studentCode:e.teacherCode})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-500",children:new Date(e.joinDate).toLocaleDateString("tr-TR")})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,r.jsx)("button",{className:"text-red-600 hover:text-red-900",onClick:()=>K(e.id),children:(0,r.jsx)(i.Ybf,{className:"h-5 w-5"})})})]},e.id)):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:6,className:"px-6 py-4 text-center text-sm text-gray-500",children:N?"Aradığınız kriterlere uygun kullanıcı bulunamadı":"Hen\xfcz kullanıcı eklenmedi"})})})]})}),E.length>5&&(0,r.jsx)("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:(0,r.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:["Toplam ",(0,r.jsx)("span",{className:"font-medium",children:E.length})," kullanıcıdan"," ",(0,r.jsxs)("span",{className:"font-medium",children:[D+1,"-",Math.min(A,E.length)]})," arası g\xf6steriliyor"]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[(0,r.jsx)("button",{onClick:()=>z(e=>Math.max(e-1,1)),disabled:1===S,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)(i.YFh,{className:"h-5 w-5"})}),Array.from({length:M},(e,a)=>a+1).map(e=>(0,r.jsx)("button",{onClick:()=>z(e),className:"relative inline-flex items-center px-4 py-2 border text-sm font-medium ".concat(S===e?"z-10 bg-amber-50 border-amber-500 text-amber-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"),children:e},e)),(0,r.jsx)("button",{onClick:()=>z(e=>Math.min(e+1,M)),disabled:S===M,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)(i.Tfp,{className:"h-5 w-5"})})]})})]})})]})]})})}},974:function(e,a,t){"use strict";var r=t(3301),l=t(5978),i=t(2265),s=t(4230);let n={"auth/user-not-found":"Bu email adresiyle kayıtlı kullanıcı bulunamadı","auth/wrong-password":"Yanlış şifre, l\xfctfen tekrar deneyin","auth/too-many-requests":"\xc7ok fazla başarısız giriş denemesi. L\xfctfen bir s\xfcre sonra tekrar deneyin","auth/user-disabled":"Bu hesap devre dışı bırakılmış","auth/invalid-email":"Ge\xe7ersiz email formatı","auth/operation-not-allowed":"Email/şifre ile giriş izni verilmemiş","auth/network-request-failed":"İnternet bağlantınız yok, l\xfctfen bağlantınızı kontrol edip tekrar deneyiniz","auth/requires-recent-login":"Bu işlem i\xe7in son zamanlarda giriş yapmış olmanız gerekiyor","auth/email-not-verified":"L\xfctfen email adresinizi doğrulayın","auth/institution-not-found":"Kurum bilgisi bulunamadı. L\xfctfen yapayline@gmail.com ile iletişime ge\xe7iniz","auth/unauthorized":"Bu işlem i\xe7in yetkiniz bulunmamaktadır","auth/no-current-user":"Kullanıcı bilgisi bulunamadı"};a.Z=()=>{let[e,a]=(0,i.useState)(null),[t,d]=(0,i.useState)(!1),[u,c]=(0,i.useState)(!1),[m,o]=(0,i.useState)(null),[x,h]=(0,i.useState)(null),[g,f]=(0,i.useState)(null),[p,y]=(0,i.useState)(!1),[b,w]=(0,i.useState)(null),v=e=>{if("object"==typeof e&&null!==e&&"code"in e){let a=e.code;return n[a]||"Bir hata oluştu: ".concat(a)}return"Beklenmeyen bir hata oluştu"},j=async(e,t,i)=>{y(!0),w(null);try{var n,u,m,x,g,p,b,j;let y=(await (0,r.e5)(s.I,e.trim(),t)).user,w="yapayline@gmail.com"===y.email;if(w){let t=await (0,l.QT)((0,l.JU)(s.db,"users",y.uid));if(!(null===(b=t.data())||void 0===b?void 0:b.isSuperAdmin))throw await (0,r.w7)(s.I),{code:"auth/unauthorized"};return c(!0),a(y),document.cookie="loggedIn=true; path=/; ".concat(i?"max-age=3600":""),i?localStorage.setItem("saved_email",e):localStorage.removeItem("saved_email"),y}if(y&&!y.emailVerified)throw await (0,r.w7)(s.I),{code:"auth/email-not-verified"};let v=await (0,l.QT)((0,l.JU)(s.db,"users",y.uid)),k=(null===(n=v.data())||void 0===n?void 0:n.isSuperAdmin)||!1;if(k&&!w)throw await (0,r.w7)(s.I),{code:"auth/unauthorized"};if(!v.exists()||!(null===(u=v.data())||void 0===u?void 0:u.kurum)&&!k)throw await (0,r.w7)(s.I),{code:"auth/institution-not-found"};return o((null===(m=v.data())||void 0===m?void 0:m.kurum)||null),h((null===(x=v.data())||void 0===x?void 0:x.kurumId)||null),f(null!==(j=null===(g=v.data())||void 0===g?void 0:g.kurumKontejan)&&void 0!==j?j:null),d((null===(p=v.data())||void 0===p?void 0:p.isStudent)||!1),c(!1),document.cookie="loggedIn=true; path=/; ".concat(i?"max-age=3600":""),i?localStorage.setItem("saved_email",e):localStorage.removeItem("saved_email"),a(y),y}catch(e){return w(v(e)),null}finally{y(!1)}},k=async e=>{try{var a,t,i,n,u,m,x,g,p,b,j;y(!0);let w=await (0,l.QT)((0,l.JU)(s.db,"users",e));if(w.exists()){let e=(null===(a=s.I.currentUser)||void 0===a?void 0:a.email)==="yapayline@gmail.com",l=(null===(t=w.data())||void 0===t?void 0:t.isSuperAdmin)||!1;if(l&&!e)throw await (0,r.w7)(s.I),{code:"auth/unauthorized"};c(e&&l),d(null!==(x=null===(i=w.data())||void 0===i?void 0:i.isStudent)&&void 0!==x&&x),o(null!==(g=null===(n=w.data())||void 0===n?void 0:n.kurum)&&void 0!==g?g:null),h(null!==(p=null===(u=w.data())||void 0===u?void 0:u.kurumId)&&void 0!==p?p:null),f(null!==(b=null===(m=w.data())||void 0===m?void 0:m.kurumKontejan)&&void 0!==b?b:null)}else(null===(j=s.I.currentUser)||void 0===j?void 0:j.email)==="yapayline@gmail.com"?c(!0):(c(!1),d(!1),o(null),h(null),f(null))}catch(e){w(v(e))}finally{y(!1)}},N=async()=>{y(!0);try{await (0,r.w7)(s.I),a(null),d(!1),c(!1),o(null),h(null),f(null),document.cookie="loggedIn=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",localStorage.removeItem("saved_email")}catch(e){w(v(e))}finally{y(!1)}},I=async e=>{y(!0);try{await (0,r.LS)(s.I,e.trim())}catch(e){w(v(e))}finally{y(!1)}},S=async(a,t)=>{y(!0);try{if(!e||!e.email)throw{code:"auth/no-current-user"};let l=r.w9.credential(e.email,t);await (0,r.aF)(e,l),await (0,r.gQ)(e,a)}catch(e){w(v(e))}finally{y(!1)}};return(0,i.useEffect)(()=>{let e=(0,r.Aj)(s.I,async e=>{e?(await k(e.uid),a(e)):(a(null),d(!1),c(!1),o(null),h(null),f(null))});return()=>e()},[]),{user:e,isStudent:t,isSuperAdmin:u,kurum:m,kurumId:x,kurumKontejan:g,isLoading:p,errorMessage:b,login:j,signOut:N,resetPassword:I,changePassword:S}}},4230:function(e,a,t){"use strict";let r,l,i;t.d(a,{I:function(){return i},db:function(){return l}});var s=t(738),n=t(5978),d=t(3301);let u={apiKey:"",authDomain:"",projectId:"",storageBucket:"",messagingSenderId:"",appId:"",measurementId:""};if(!(0,s.C6)().length){if(Object.values(u).every(e=>void 0!==e&&""!==e))try{r=(0,s.ZF)(u),l=(0,n.ad)(r),i=(0,d.v0)(r)}catch(e){console.error("Firebase initialization error",e)}else console.error("Firebase config is missing or incomplete")}}},function(e){e.O(0,[358,242,956,943,67,971,117,744],function(){return e(e.s=6147)}),_N_E=e.O()}]);