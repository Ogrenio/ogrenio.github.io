(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{6147:function(e,a,t){Promise.resolve().then(t.bind(t,8999))},8999:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return h}});var r=t(7437),l=t(2265),i=t(7996),s=t(4230),n=t(5978);let d=async(e,a)=>{try{if(null!==a){let t=await c(e.kurumId);if(t.length>=a)throw Error("Kurum kontenjanı dolu (".concat(t.length,"/").concat(a,")"))}let t=(0,n.hJ)(s.db,"users"),r=(0,n.IO)(t,(0,n.ar)("email","==",e.email)),l=await (0,n.PL)(r);if(l.empty)throw Error("Kullanıcı bulunamadı");let i=l.docs[0],d=i.id;if((await c(e.kurumId)).some(e=>e.id===d))throw Error("Bu kullanıcı zaten kuruma kayıtlı");let o=(0,n.hJ)(s.db,"kurumUsers");return await (0,n.ET)(o,{userId:d,kurumId:e.kurumId,email:e.email,joinDate:new Date().toISOString().split("T")[0]}),await (0,n.pl)((0,n.JU)(s.db,"users",d),{...i.data(),kurumId:e.kurumId},{merge:!0}),d}catch(e){throw console.error("Error adding user to kurum: ",e),e}},c=async e=>{try{let a=(0,n.hJ)(s.db,"kurumUsers"),t=(0,n.IO)(a,(0,n.ar)("kurumId","==",e)),r=(await (0,n.PL)(t)).docs.map(e=>e.data().userId);if(0===r.length)return[];let l=r.map(async e=>{let a=await (0,n.QT)((0,n.JU)(s.db,"users",e));return{id:e,...a.data()}});return await Promise.all(l)}catch(e){throw console.error("Error fetching kurum users: ",e),e}},o=async(e,a)=>{try{let t=(0,n.hJ)(s.db,"kurumUsers"),r=(0,n.IO)(t,(0,n.ar)("userId","==",e),(0,n.ar)("kurumId","==",a)),l=await (0,n.PL)(r);if(l.empty)throw Error("Kurum-kullanıcı ilişkisi bulunamadı");let i=l.docs.map(e=>(0,n.oe)(e.ref));return await Promise.all(i),await (0,n.pl)((0,n.JU)(s.db,"users",e),{kurumId:null},{merge:!0}),!0}catch(e){throw console.error("Error removing user from kurum: ",e),e}};var u=t(974),m=t(9064),x=t(9376),h=()=>{let[e,a]=(0,l.useState)(!1),[t,n]=(0,l.useState)([]),{user:h,kurumKontejan:f,isStudent:g,kurum:p,kurumId:y}=(0,u.Z)(),[b,w]=(0,l.useState)(!0),[v,j]=(0,l.useState)({email:"",ogrenciMi:!0,studentCode:"",teacherCode:""}),[k,N]=(0,l.useState)(""),[I,z]=(0,l.useState)(1),K=(0,x.useRouter)(),C=async e=>{if(!y){m.Am.error("Kurum bilgisi bulunamadı");return}if(window.confirm("Bu kullanıcıyı kurumdan \xe7ıkarmak istediğinize emin misiniz?"))try{await o(e,y);let a=await c(y);n(a),m.Am.success("Kullanıcı kurumdan başarıyla \xe7ıkarıldı")}catch(e){console.error("Error removing user: ",e),m.Am.error("Kullanıcı \xe7ıkarılırken hata oluştu: "+e.message)}};(0,l.useEffect)(()=>{a(!0),(async()=>{try{if(y){let e=await c(y);n(e)}else m.Am.error("Kurum bilgisi bulunamadı")}catch(e){console.error("Error fetching users: ",e),m.Am.error("Kullanıcılar y\xfcklenirken hata oluştu")}finally{w(!1)}})()},[y]),(0,l.useEffect)(()=>{(async()=>{try{let e=s.I.onAuthStateChanged(e=>{e?w(!1):K.push("/login")});return()=>e()}catch(e){console.error("Auth check failed:",e),K.push("/login")}})()},[K]);let S=async()=>{if(!v.email||!y){m.Am.error("Email alanı boş bırakılamaz");return}try{if(null!==f&&t.length>=f){m.Am.error("Kurum kontenjanı dolu (".concat(t.length,"/").concat(f,"). Daha fazla kullanıcı ekleyemezsiniz."));return}await d({email:v.email,kurumId:y},f);let e=await c(y);n(e),j({email:"",ogrenciMi:!0,studentCode:"",teacherCode:""}),m.Am.success("Kullanıcı başarıyla eklendi")}catch(e){console.error("Error adding user: ",e),m.Am.error("Kullanıcı eklenirken hata oluştu: "+e.message)}},E=t.filter(e=>{var a,t,r;return(null===(a=e.isim)||void 0===a?void 0:a.toLowerCase().includes(k.toLowerCase()))||e.email.toLowerCase().includes(k.toLowerCase())||e.ogrenciMi&&(null===(t=e.studentCode)||void 0===t?void 0:t.toLowerCase().includes(k.toLowerCase()))||!e.ogrenciMi&&(null===(r=e.teacherCode)||void 0===r?void 0:r.toLowerCase().includes(k.toLowerCase()))}),L=5*I,A=L-5,M=E.slice(A,L),T=Math.ceil(E.length/5);return b?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-secondary"})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[h&&(0,r.jsx)("div",{className:"bg-white shadow rounded-lg p-6 mb-8",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4 mb-4 md:mb-0",children:[(0,r.jsx)("div",{className:"flex-shrink-0 h-12 w-12 rounded-full bg-amber-100 flex items-center justify-center",children:(0,r.jsx)(i.fzv,{className:"h-6 w-6 text-amber-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:h.email}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:g?"\xd6ğrenci":"\xd6ğretmen"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(i.m6D,{className:"h-5 w-5 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Kurum"}),(0,r.jsx)("p",{className:"text-sm text-gray-900",children:p||"Bilinmiyor"})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(i.WY8,{className:"h-5 w-5 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Kurum \xdcye Kontenjanı"}),(0,r.jsx)("p",{className:"text-sm text-gray-900",children:null!==f?(0,r.jsxs)("span",{children:[t.length,"/",f," (Kalan: ",f-t.length,")"]}):"Sınırsız"}),null!==f&&(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mt-1",children:(0,r.jsx)("div",{className:"bg-amber-600 h-1.5 rounded-full",style:{width:"".concat(Math.min(100,t.length/f*100),"%")}})})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(i.yK7,{className:"h-5 w-5 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Durum"}),(0,r.jsx)("p",{className:"text-sm text-gray-900",children:g?"\xd6ğrenci":"\xd6ğretmen"})]})]})]})]})}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Kurum Y\xf6netimi"}),(0,r.jsxs)("div",{className:"relative mt-4 md:mt-0 w-full md:w-auto",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)(i.jRj,{className:"h-5 w-5 text-gray-400"})}),(0,r.jsx)("input",{type:"text",placeholder:"Kullanıcı ara...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 sm:text-sm",value:k,onChange:e=>N(e.target.value)})]})]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden mb-8",children:[(0,r.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Yeni Kullanıcı Ekle"}),(0,r.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Adresi"}),(0,r.jsx)("input",{type:"email",id:"email",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm",placeholder:"email@example.com",value:v.email,onChange:e=>j({...v,email:e.target.value})})]}),(0,r.jsx)("div",{className:"flex items-end space-x-4",children:(0,r.jsxs)("button",{type:"button",onClick:S,disabled:!v.email,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,r.jsx)(i.OvN,{className:"mr-2 h-4 w-4"}),"Kullanıcı Ekle"]})})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kullanıcı"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"T\xfcr"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kod"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Katılım Tarihi"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"İşlemler"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:M.length>0?M.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-amber-100 flex items-center justify-center",children:(0,r.jsx)(i.fzv,{className:"h-5 w-5 text-amber-600"})}),(0,r.jsx)("div",{className:"ml-4",children:(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.isim||"İsim belirtilmemiş"})})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(i.Imn,{className:"flex-shrink-0 mr-2 h-4 w-4 text-gray-400"}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.ogrenciMi?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:e.ogrenciMi?"\xd6ğrenci":"\xd6ğretmen"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.ogrenciMi?e.studentCode:e.teacherCode})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-500",children:new Date(e.joinDate).toLocaleDateString("tr-TR")})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,r.jsx)("button",{className:"text-red-600 hover:text-red-900",onClick:()=>C(e.id),children:(0,r.jsx)(i.Ybf,{className:"h-5 w-5"})})})]},e.id)):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:6,className:"px-6 py-4 text-center text-sm text-gray-500",children:k?"Aradığınız kriterlere uygun kullanıcı bulunamadı":"Hen\xfcz kullanıcı eklenmedi"})})})]})}),E.length>5&&(0,r.jsx)("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:(0,r.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:["Toplam ",(0,r.jsx)("span",{className:"font-medium",children:E.length})," kullanıcıdan"," ",(0,r.jsxs)("span",{className:"font-medium",children:[A+1,"-",Math.min(L,E.length)]})," arası g\xf6steriliyor"]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[(0,r.jsx)("button",{onClick:()=>z(e=>Math.max(e-1,1)),disabled:1===I,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)(i.YFh,{className:"h-5 w-5"})}),Array.from({length:T},(e,a)=>a+1).map(e=>(0,r.jsx)("button",{onClick:()=>z(e),className:"relative inline-flex items-center px-4 py-2 border text-sm font-medium ".concat(I===e?"z-10 bg-amber-50 border-amber-500 text-amber-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"),children:e},e)),(0,r.jsx)("button",{onClick:()=>z(e=>Math.min(e+1,T)),disabled:I===T,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)(i.Tfp,{className:"h-5 w-5"})})]})})]})})]})]})})}},974:function(e,a,t){"use strict";var r=t(3301),l=t(5978),i=t(2265),s=t(4230);let n={"auth/user-not-found":"Bu email adresiyle kayıtlı kullanıcı bulunamadı","auth/wrong-password":"Yanlış şifre, l\xfctfen tekrar deneyin","auth/too-many-requests":"\xc7ok fazla başarısız giriş denemesi. L\xfctfen bir s\xfcre sonra tekrar deneyin","auth/user-disabled":"Bu hesap devre dışı bırakılmış","auth/invalid-email":"Ge\xe7ersiz email formatı","auth/operation-not-allowed":"Email/şifre ile giriş izni verilmemiş","auth/network-request-failed":"İnternet bağlantınız yok, l\xfctfen bağlantınızı kontrol edip tekrar deneyiniz","auth/requires-recent-login":"Bu işlem i\xe7in son zamanlarda giriş yapmış olmanız gerekiyor","auth/email-not-verified":"L\xfctfen email adresinizi doğrulayın","auth/institution-not-found":"Kurum bilgisi bulunamadı. Giriş yapamazsınız. L\xfctfen kurum paketi anlaşması sağlamak i\xe7in iletişime ge\xe7iniz: yapayline@gmail.com","auth/invalid-api-key":"Firebase yapılandırma hatası. L\xfctfen y\xf6netici ile iletişime ge\xe7in."};a.Z=()=>{let[e,a]=(0,i.useState)(null),[t,d]=(0,i.useState)(!1),[c,o]=(0,i.useState)(null),[u,m]=(0,i.useState)(null),[x,h]=(0,i.useState)(null),[f,g]=(0,i.useState)(!1),[p,y]=(0,i.useState)(null),b=e=>{if("object"==typeof e&&null!==e&&"code"in e){let a=e.code;return n[a]||"Bir hata oluştu: ".concat(a)}return"Beklenmeyen bir hata oluştu"},w=async(e,t,i)=>{g(!0),y(null);try{var n,c,u,x,f,p;if(!s.I)throw{code:"auth/invalid-api-key"};let g=(await (0,r.e5)(s.I,e.trim(),t)).user;if(g&&!g.emailVerified)throw await (0,r.w7)(s.I),{code:"auth/email-not-verified"};if(document.cookie="loggedIn=true; path=/; ".concat(i?"max-age=3600":""),!s.db)throw{code:"auth/invalid-api-key"};let y=await (0,l.QT)((0,l.JU)(s.db,"users",g.uid));if(!y.exists()||!(null===(n=y.data())||void 0===n?void 0:n.kurum))throw await (0,r.w7)(s.I),{code:"auth/institution-not-found"};return o((null===(c=y.data())||void 0===c?void 0:c.kurum)||null),m((null===(u=y.data())||void 0===u?void 0:u.kurumId)||null),h(null!==(p=null===(x=y.data())||void 0===x?void 0:x.kurumKontejan)&&void 0!==p?p:null),d((null===(f=y.data())||void 0===f?void 0:f.isStudent)||!1),i?localStorage.setItem("saved_email",e):localStorage.removeItem("saved_email"),a(g),g}catch(e){return y(b(e)),null}finally{g(!1)}},v=async e=>{try{if(g(!0),!s.db)throw{code:"auth/invalid-api-key"};let f=await (0,l.QT)((0,l.JU)(s.db,"users",e));if(f.exists()){var a,t,r,i,n,c,u,x;d(null!==(n=null===(a=f.data())||void 0===a?void 0:a.isStudent)&&void 0!==n&&n),o(null!==(c=null===(t=f.data())||void 0===t?void 0:t.kurum)&&void 0!==c?c:null),m(null!==(u=null===(r=f.data())||void 0===r?void 0:r.kurumId)&&void 0!==u?u:null),h(null!==(x=null===(i=f.data())||void 0===i?void 0:i.kurumKontejan)&&void 0!==x?x:null)}else d(!1),o(null),m(null),h(null)}catch(e){y("Kullanıcı bilgileri alınırken hata oluştu")}finally{g(!1)}},j=async()=>{g(!0);try{s.I&&await (0,r.w7)(s.I),a(null),d(!1),o(null),m(null),document.cookie="loggedIn=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",localStorage.removeItem("saved_email")}catch(e){y(b(e))}finally{g(!1)}},k=async e=>{g(!0);try{if(!s.I)throw{code:"auth/invalid-api-key"};await (0,r.LS)(s.I,e.trim())}catch(e){y(b(e))}finally{g(!1)}},N=async(a,t)=>{g(!0);try{if(!e||!e.email)throw{code:"auth/no-current-user"};if(!s.I)throw{code:"auth/invalid-api-key"};let l=r.w9.credential(e.email,t);await (0,r.aF)(e,l),await (0,r.gQ)(e,a)}catch(e){y(b(e))}finally{g(!1)}};return(0,i.useEffect)(()=>{if(!s.I)return()=>{};let e=(0,r.Aj)(s.I,async e=>{e?(await v(e.uid),a(e)):(a(null),d(!1),o(null),m(null))});return()=>e()},[]),{user:e,isStudent:t,kurum:c,kurumId:u,kurumKontejan:x,isLoading:f,errorMessage:p,login:w,signOut:j,resetPassword:k,changePassword:N}}},4230:function(e,a,t){"use strict";let r,l,i;t.d(a,{I:function(){return i},db:function(){return l}});var s=t(738),n=t(5978),d=t(3301);let c={apiKey:"",authDomain:"",projectId:"",storageBucket:"",messagingSenderId:"",appId:"",measurementId:""};if(!r)try{if(Object.entries(c).filter(e=>{let[a,t]=e;return!t}).map(e=>{let[a]=e;return a}).length>0)throw Error("Missing Firebase configuration values");let e=(0,s.C6)();r=e.length?e[0]:(0,s.ZF)(c),l=(0,n.ad)(r),i=(0,d.v0)(r)}catch(e){console.error("Firebase initialization error:",e),r=void 0,l=void 0,i=void 0}}},function(e){e.O(0,[358,242,956,943,198,971,117,744],function(){return e(e.s=6147)}),_N_E=e.O()}]);